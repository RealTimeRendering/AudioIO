<html>
<head>
    <title></title>
</head>
<body>
    <canvas id="one"></canvas>
    <br />
    <canvas id="two"></canvas>

    <input type="number" value="0" min="0" max="1" step="0.1" id="phase" />
    <input type="number" value="1" min="110" max="25000" step="110" id="frequency" />
    <input type="number" value="0" min="-100" max="100" step="1" id="detune" />

    <script type="text/javascript" src="../../../build/AudioIO.js"></script>
    <script type="text/javascript" src="../Oscilloscope.js"></script>

    <script type="text/javascript">
        var io = new AudioIO(),
            output = io.context.createGain(),
            scope = new Oscilloscope( '#one', io ),
            scope2 = new Oscilloscope( '#two', io ),
            osc = io.createBufferOscillator( AudioIO.BufferGenerators.SineWave ),
            nativeOsc = io.context.createOscillator(),
            frequencyControl = io.createConstant( 1 ),
            detuneControl = io.createConstant( 0 ),
            phase = 0,
            playing = false;



        output.gain.value = 1;
        nativeOsc.frequency.value = 0;
        

        frequencyControl.connect( osc.controls.frequency );
        detuneControl.connect( osc.controls.detune );
        frequencyControl.connect( nativeOsc.frequency );
        detuneControl.connect( nativeOsc.detune );

        osc.connect( scope.analyser );
        osc.connect( output );
        nativeOsc.connect( scope2.analyser );
        output.connect( io.master );

        scope.start();
        scope2.start();

        nativeOsc.start();


        document.addEventListener( 'keydown', function() {
            if( playing === false ) {
                playing = true;
                osc.start( 0, phase );
            }
        } );
        document.addEventListener( 'keyup', function() {
            if( playing === true ) {
                playing = false;
                osc.stop( 0 );
            }
        } );


        document.querySelector( '#phase' ).addEventListener( 'input', function( e ) {
            phase = +e.target.value;
        } );

        document.querySelector( '#frequency' ).addEventListener( 'input', function( e ) {
            frequencyControl.value = +e.target.value;
        } );

        document.querySelector( '#detune' ).addEventListener( 'input', function( e ) {
            detuneControl.value = +e.target.value;
        } );
    </script>
</body>
</html>